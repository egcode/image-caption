<html>
  <head>
    <title>File upload Node.</title>
  </head>
  <body>
      
        <div id="formDiv" >
            <form id="uploadForm"
                enctype="multipart/form-data"
                action="/api/photo"
                method="post">
            <!-- <input type='file' name='fileUploaded' accept="image/x-png, image/jpeg"> -->
             <input type="file" name="userPhoto" accept="image/x-png, image/jpeg"/>
             <input type="submit" value="Upload Image" name="submit">
             <span id = "status"></span>
        </div>   
    

        <div id="imageDiv" >
            <img id="imageView"  src="" width="500">
        </div>   

        <div id="captionDiv">
            <button type="button" id="caption" onclick="getImageCaptionFromServer()">Get Image Caption</button>        
        </div>   

         
        <div class="messages">
             <!-- Image Caption goes here  -->
        </div> 

        <div id="refreshButtonDiv">
            <button type="button" id="restart" onclick="refreshClick()">Retry</button>        
        </div>  
    

    </form>
  </body>
  <script type="text/javascript" src="/js/app.js"></script>
  <script src="/js/jquery-3.1.0.min.js"></script>
  <script src="/js/jquery.form.min.js"></script>
  <script>

const ENUM_INITIAL_STATE  = 0,
    ENUM_PREPROCESS_STATE = 1,
    ENUM_COMPLETED_STATE  = 2;

function uiState(state) {
  if (state == ENUM_INITIAL_STATE) {
      $("#formDiv").show();
      $("#imageDiv").hide();
      $("#captionDiv").hide();
      $(".messages").hide();
      $("#refreshButtonDiv").hide();
  } else if (state == ENUM_PREPROCESS_STATE) {
      $("#formDiv").hide();
      $("#imageView").attr('src', '/img/imagedata');
      $("#imageDiv").show();
      $("#captionDiv").show();
      $(".messages").show();
      $("#refreshButtonDiv").hide();
  } else if (state == ENUM_COMPLETED_STATE) {
      uiState(ENUM_PREPROCESS_STATE);
      $("#refreshButtonDiv").show();
  }
}

// Initial UI state
uiState(ENUM_INITIAL_STATE);

// UPLOAD
$(document).ready(function() {
    $('#uploadForm').submit(function() {
    $("#status").empty().text("File is uploading...");
    $(this).ajaxSubmit({

        error: function(xhr) {
            status('Error: ' + xhr.status);
        },

        success: function(response) {
            $("#status").empty().text(response);
                console.log(response);
                console.log("ZAYEBIS UPLOADED");
                uiState(ENUM_PREPROCESS_STATE);
        }
    });
        //Very important line, it disable the page refresh.
        return false;
    });    
});

  </script>
  
</html>

